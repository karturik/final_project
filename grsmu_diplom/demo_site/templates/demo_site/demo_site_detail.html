{% extends "base.html" %}
{% block page_content %}
{% load static %}


    <div class="container">
            <div class="top">

        <div class="row justify-content-md-center">
    <div class="col-md-auto">
    {% if teacher.teacher_img %}
    <img class = "img_detail" src="{{ teacher.teacher_img.url }}" alt="Teacher Picture" >
    {% else %}
    <img class = "img_detail" src="{% static 'images/teacher.jpg' %}" alt="Teacher Picture" >
    {% endif %}
    </div>

    <div class="col-md">
        <div class="row">
    <h1>{{ teacher.name }}</h1>
    <small>
        {{ teacher.position }} |&nbsp;
        Кафедра: <a href="{% url 'demo_site_department' teacher.department.title %}">
    {{ teacher.department.title }}
    </a>
    </small>
    <p class="text-muted" style="font-size:12px">Коммуникабельность: {{ teacher.communication_average }} | Обучение: {{ teacher.teaching_average }} | Требовательность: {{ teacher.demanding_average }}</p>
    </div>
    <div class="row">
        <div class="col-md"> Коммуникабельность
    <div class="pie" style="--p:{{ teacher.communication_average }};--c:#0d6efd;--b:8px"> {{ teacher.communication_average }}</div>
    </div>
    <div class="col-md"> Обучение
    <div class="pie" style="--p:{{ teacher.teaching_average }};--c:#0d6efd;--b:8px"> {{ teacher.teaching_average }}</div>
    </div>
    <div class="col-md"> Требовательность
    <div class="pie" style="--p:{{ teacher.demanding_average }};--c:#0d6efd;--b:8px"> {{ teacher.demanding_average }}</div>
    </div>
     <small>Количество голосов: {{ vote_count }}</small>

    </div>
    </div>
    </div>
</div>
</div>



<!--    ОСТАВИТЬ КОММЕНТАРИЙ-->
    {% if user.is_authenticated %}
    <h3>Оставьте комментарий:</h3>
    <form action="/demo_site/teacher/{{ teacher.pk }}/" method="post">
        {% csrf_token %}
        <div class="form-group">
            {{ comment_form.body }}
        </div>
        <a class="btn btn-outline-primary" data-toggle="collapse" href="#collapse{{teacher.pk}}" role="button" aria-expanded="false" aria-controls="collapse{{teacher.pk}}">Оценка</a>
        <button type="submit" name="comment_left" class="btn btn-primary">Отправить</button>
    </form>
<!--VOTING-->
    <div class = "collapse" id = "collapse{{ teacher.pk }}">
        <div class="vote-card shadow">

            <h6>Оценить: {{ teacher.name }}</h6>
            <hr>
            <form method="post">
                {% csrf_token %}
                {% for field in vote_form %}
                    <div class="row">
                        <div class="col-10" id="slider_{{field.name}}_{{teacher.pk}}" onclick="sliderUpdate('{{field.name}}', {{teacher.pk}})">
                            {{field.label}}
                            <p>{{field}}</p>
                        </div>
                        <div class="col-2 my-auto">
                            <h6 class="text-center"><span id="score_{{field.name}}_{{teacher.pk}}" class="text-primary">6</span></h6>
                        </div>
                    </div>
                {% endfor %}
                <div class="text-right">
                    <button type="submit" name="score_submit" class="btn btn-outline-primary">Оценить</button>
                </div>
            </form>
        </div>
</div>
<!--END VOTING-->
    {% else %}
    <div class="card">
    <div class="card-header">
    Оставить комментарий
    </div>
    <div class="card-body">
    <p class="card-text">Чтобы оставлять и читать комментарии необходимо войти в аккаунт!</p>
    <a href="/user/login" class="btn btn-primary">Войти</a>
    </div>
    </div>
    {% endif %}

<!--COMMENTS-->
    {% if group == 'Student' %}
    <h3>Комментарии:</h3>
    {% for comment in comments %}
            <div class="media g-mb-30 media-comment">
                {% if comment.author.profile.profile_pic %}
                <img class="d-flex g-width-50 g-height-50 rounded-circle g-mt-3 g-mr-15 comment-img" src="{{ comment.author.profile.profile_pic.url }}" alt="Image Description">
            	{% else %}
                <img class="d-flex g-width-50 g-height-50 rounded-circle g-mt-3 g-mr-15 comment-img" src="{% static 'images/user.jpg' %}" alt="Image Description">
                {% endif %}
            <div class="media-body u-shadow-v18 g-bg-secondary g-pa-30">
              <div class="g-mb-15">
                <h5 class="h5 g-color-gray-dark-v1 mb-0">{{ comment.author }}</h5>
                <span class="g-color-gray-dark-v4 g-font-size-12">{{comment.created_on.date }}</span>
                <p>{{ comment.body }}</p>
            </div>
            {% if comment.author == request.user or request.user.is_superuser %}
            <form method="post" id="comment-deletion" style="margin-bottom: -25px;">
            {% csrf_token %}
            <button type="submit" name="comment_delete" class="btn btn-danger">Удалить</button>
            <input type="hidden" name="comment_pk" value="{{ comment.pk }}">
            <a href="{% url 'comment_edit' comment.pk %}">Изменить</a>
            {% endif %}
            <a data-toggle="collapse" href="#collapse{{comment.pk}}" role="button" aria-expanded="false" aria-controls="collapse{{comment.pk}}">Ответить</a>
            </form>
            </div>
        </div>
<!--ANSWERS-->
    {% for answer in comment_answers %}
    {% if answer.comment == comment %}
        <div class="media g-mb-30 media-comment-answer">
                {% if answer.author.profile.profile_pic %}
                <img class="d-flex g-width-50 g-height-50 rounded-circle g-mt-3 g-mr-15 comment-answer-img" src="{{ answer.author.profile.profile_pic.url }}" alt="Image Description">
            	{% else %}
                <img class="d-flex g-width-50 g-height-50 rounded-circle g-mt-3 g-mr-15 comment-answer-img" src="{% static 'images/user.jpg' %}" alt="Image Description">
                {% endif %}
                <div class="media-body u-shadow-v18 g-bg-secondary g-pa-30">
              <div class="g-mb-15">
                <h5 class="h5 g-color-gray-dark-v1 mb-0">{{ answer.author }}</h5>
                <span class="g-color-gray-dark-v4 g-font-size-12">{{answer.created_on.date }}</span>
                <p>{{ answer.body }}</p>
            </div>
            {% if answer.author == request.user or request.user.is_superuser %}
            <form method="post" style="margin-bottom: -25px;">
                {% csrf_token %}
                    <button type="submit" name="answer_delete" class="btn btn-danger">Удалить</button>
                    <input type="hidden" name="answer_pk" value="{{ answer.pk }}">
            </form>
            {% endif %}
            </div>
            </div>
    {% endif %}
    {% endfor %}

    <!--COMMENT ANSWER-->
    <div class = "collapse" id = "collapse{{comment.pk}}">
        <div class="vote-card shadow">
            <form method="post">
                {% csrf_token %}
                <p>{{answer_form.body}}</p>
                <div class="text-right">
                    <input type="hidden" name="comment_pk" value="{{ comment.pk }}">
                    <button type="submit" name="comment_answer" class="btn btn-outline-primary">Ответить</button>
                </div>
            </form>
        </div>
</div>
    {% endfor %}
<!--COMMENT ANSWER-->


    {% elif group == 'Not_student' %}
    <div class="card">
    <div class="card-header">
    Комментарии
    </div>
    <div class="card-body">
    <p class="card-text">Чтобы просматривать комментарии необходимо подтвердить аккаунт!</p>
    <a href="/user/profile" class="btn btn-primary">Подтвердить</a>
    </div>
    </div>
    {% endif %}




<script>
    function sliderUpdate(field, pk) {
        document.getElementById("score_" + field + "_" + pk).innerText = document.getElementById("slider_" + field + "_" + pk).getElementsByClassName(field)[0].value;
        }
</script>

{% endblock %}